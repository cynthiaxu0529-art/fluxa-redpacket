<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FluxA Agent Red Packet</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      color: white;
      padding: 20px;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      padding: 30px 0 10px;
      font-size: 2.5em;
      background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcb77);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .subtitle {
      text-align: center;
      color: #aaa;
      margin-bottom: 30px;
      font-size: 1.1em;
    }

    .card {
      background: linear-gradient(135deg, rgba(255, 107, 107, 0.15), rgba(255, 217, 61, 0.08));
      border: 2px solid rgba(255, 107, 107, 0.5);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 20px;
    }

    .card h2 {
      color: #ff6b6b;
      margin-bottom: 15px;
      font-size: 1.3em;
    }

    .input-group {
      margin-bottom: 15px;
    }

    .input-group label {
      display: block;
      margin-bottom: 8px;
      color: #ddd;
      font-size: 0.95em;
    }

    .input-group input {
      width: 100%;
      padding: 15px;
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 12px;
      background: rgba(255,255,255,0.05);
      color: white;
      font-size: 1em;
      font-family: monospace;
    }

    .input-group input:focus {
      outline: none;
      border-color: #ff6b6b;
    }

    .input-group input::placeholder {
      color: rgba(255,255,255,0.3);
    }

    .redpacket-grab {
      background: linear-gradient(135deg, #ff6b6b, #d63031);
      border-radius: 20px;
      padding: 50px 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      margin: 20px 0;
      border: none;
      width: 100%;
    }

    .redpacket-grab:hover {
      transform: scale(1.03);
      box-shadow: 0 15px 40px rgba(255, 107, 107, 0.4);
    }

    .redpacket-grab:disabled {
      cursor: not-allowed;
      opacity: 0.7;
      transform: none;
    }

    .grab-icon {
      font-size: 5em;
      margin-bottom: 15px;
      animation: shake 2s infinite;
    }

    @keyframes shake {
      0%, 100% { transform: rotate(-5deg); }
      50% { transform: rotate(5deg); }
    }

    .grab-text {
      font-size: 1.4em;
      font-weight: bold;
      color: white;
    }

    .grab-hint {
      font-size: 0.85em;
      color: rgba(255,255,255,0.7);
      margin-top: 8px;
    }

    .result {
      margin-top: 20px;
      padding: 18px;
      border-radius: 15px;
      display: none;
      font-size: 0.95em;
      line-height: 1.6;
    }

    .result.success {
      display: block;
      background: rgba(107, 203, 119, 0.2);
      border: 2px solid #6bcb77;
    }

    .result.error {
      display: block;
      background: rgba(255, 107, 107, 0.2);
      border: 2px solid #ff6b6b;
    }

    .received-card {
      background: linear-gradient(135deg, #ffd93d, #ff6b6b);
      border-radius: 20px;
      padding: 40px 30px;
      text-align: center;
      margin: 20px 0;
    }

    .received-amount {
      font-size: 3.5em;
      font-weight: bold;
      color: white;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .received-label {
      font-size: 1.3em;
      color: rgba(255,255,255,0.9);
      margin-bottom: 15px;
    }

    .received-message {
      font-size: 1.1em;
      color: white;
      font-style: italic;
      padding: 12px 15px;
      background: rgba(255,255,255,0.2);
      border-radius: 10px;
      margin-top: 15px;
    }

    .tx-hash {
      text-align: center;
      margin-top: 15px;
      padding: 12px;
      background: rgba(107, 203, 119, 0.2);
      border-radius: 10px;
      color: #6bcb77;
      font-family: monospace;
      font-size: 0.85em;
      word-break: break-all;
    }

    .opening .grab-icon {
      animation: pulse 0.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }

    .confetti {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 1000;
    }

    .confetti-piece {
      position: absolute;
      width: 10px;
      height: 10px;
      animation: fall 3s ease-out forwards;
    }

    @keyframes fall {
      0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }

    .mcp-badge {
      display: block;
      text-align: center;
      margin-bottom: 25px;
    }

    .mcp-badge span {
      display: inline-block;
      background: linear-gradient(90deg, #ff6b6b, #6bcb77);
      padding: 6px 15px;
      border-radius: 20px;
      font-size: 0.8em;
    }

    .wallet-link {
      text-align: center;
      margin-top: 15px;
      font-size: 0.85em;
    }

    .wallet-link a {
      color: #6bcb77;
      text-decoration: none;
    }

    .wallet-link a:hover {
      text-decoration: underline;
    }

    .claimed-badge {
      display: inline-block;
      background: rgba(107, 203, 119, 0.3);
      border: 1px solid #6bcb77;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8em;
      color: #6bcb77;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>FluxA Red Packet</h1>
    <p class="subtitle">FluxA Team Red Packet</p>

    <div class="mcp-badge">
      <span>Agent Wallet Payment | x402 Protocol</span>
    </div>

    <!-- Claim Red Packet -->
    <div class="card" id="claimCard">
      <h2>Claim Red Packet</h2>

      <div class="input-group">
        <label>Your FluxA Wallet Address</label>
        <input type="text" id="walletAddress" placeholder="0x...">
      </div>

      <div class="redpacket-grab" id="grabArea" onclick="claimRedPacket()">
        <div class="grab-icon">ðŸ§§</div>
        <div class="grab-text">Claim Red Packet</div>
        <div class="grab-hint">Random 10-20 USDC</div>
      </div>

      <div id="claimResult" class="result"></div>
    </div>

    <!-- Result Display -->
    <div class="card" id="receivedCard" style="display: none;">
      <h2>Red Packet Claimed!</h2>

      <div class="received-card">
        <div class="received-amount" id="receivedAmount">0.00</div>
        <div class="received-label">USDC</div>
        <div class="received-message" id="receivedMessage"></div>
      </div>

      <div class="tx-hash" id="txHash"></div>

      <div style="text-align: center; margin-top: 12px;">
        <span class="claimed-badge" id="claimedWallet"></span>
      </div>

      <div class="wallet-link">
        <p style="margin-top: 15px; color: #aaa;">
          <a href="https://agentwallet.fluxapay.xyz" target="_blank">FluxA Wallet &rarr;</a>
        </p>
      </div>
    </div>
  </div>

  <!-- Confetti -->
  <div class="confetti" id="confetti"></div>

  <script>
    // Blessings
    const blessings = [
      "Gong Xi Fa Cai!",
      "Wishing you prosperity!",
      "May fortune smile on you!",
      "Best wishes for the New Year!",
      "Luck and happiness to you!",
      "May all your wishes come true!",
      "Peace and joy in the New Year!",
      "Wishing you great success!",
      "Fortune favors the bold!",
      "Happy New Year!"
    ];

    function getRandomBlessing() {
      return blessings[Math.floor(Math.random() * blessings.length)];
    }

    function getRandomAmount() {
      return parseFloat((Math.random() * 10 + 10).toFixed(2));
    }

    // Claim red packet
    async function claimRedPacket() {
      const walletInput = document.getElementById('walletAddress');
      const wallet = walletInput.value.trim();
      const area = document.getElementById('grabArea');

      // Validate wallet address
      if (!wallet || !wallet.startsWith('0x') || wallet.length !== 42) {
        showResult('Please enter a valid wallet address (0x + 40 hex characters)', 'error');
        return;
      }

      // Disable button to prevent double click
      area.onclick = null;
      area.classList.add('opening');
      area.querySelector('.grab-text').textContent = 'Processing...';
      area.querySelector('.grab-hint').textContent = '';

      const amount = getRandomAmount();
      const blessing = getRandomBlessing();

      // Wait for animation
      await new Promise(r => setTimeout(r, 1500));

      try {
        const response = await fetch('/api/fluxapay/transfer', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ to: wallet, amount: amount })
        });

        const data = await response.json();

        if (data.success) {
          // Hide claim card, show result
          document.getElementById('claimCard').style.display = 'none';
          document.getElementById('receivedCard').style.display = 'block';
          document.getElementById('receivedAmount').textContent = amount.toFixed(2);
          document.getElementById('receivedMessage').textContent = blessing;
          document.getElementById('txHash').innerHTML =
            'Fluxapay Transfer Success<br><code>' + data.txHash + '</code>';
          document.getElementById('claimedWallet').textContent =
            wallet.slice(0, 6) + '...' + wallet.slice(-4);

          celebrate();
        } else {
          showResult('Transfer failed: ' + (data.error || 'Unknown error'), 'error');
          resetGrabArea();
        }
      } catch (err) {
        showResult('Network error: ' + err.message, 'error');
        resetGrabArea();
      }
    }

    function resetGrabArea() {
      const area = document.getElementById('grabArea');
      area.classList.remove('opening');
      area.querySelector('.grab-icon').textContent = 'ðŸ§§';
      area.querySelector('.grab-text').textContent = 'Claim Red Packet';
      area.querySelector('.grab-hint').textContent = 'Random 10-20 USDC';
      area.onclick = claimRedPacket;
    }

    function showResult(message, type) {
      const el = document.getElementById('claimResult');
      el.className = 'result ' + type;
      el.style.display = 'block';
      el.textContent = message;

      // Auto-hide after 5 seconds
      setTimeout(function() {
        el.style.display = 'none';
      }, 5000);
    }

    function celebrate() {
      const container = document.getElementById('confetti');
      container.innerHTML = '';

      for (let i = 0; i < 50; i++) {
        const piece = document.createElement('div');
        piece.className = 'confetti-piece';
        piece.style.left = Math.random() * 100 + '%';
        piece.style.background = ['#ff6b6b', '#ffd93d', '#6bcb77', '#4ecdc4', '#ff8e53'][Math.floor(Math.random() * 5)];
        piece.style.animationDelay = Math.random() * 0.5 + 's';
        container.appendChild(piece);
      }

      setTimeout(function() { container.innerHTML = ''; }, 3500);
    }
  </script>
</body>
</html>
